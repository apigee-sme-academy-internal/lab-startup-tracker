#!/usr/bin/env node

const monitor = require('../src/monitor');
const handler = require('../src/handler');
const yargs = require('yargs');


/**
 * Args processing
 */
var argv = yargs
    .command(
        'monitor',
        'Monitor tasks',
        function (yargs) {},
        async function (argv) {
            await monitor();
        }
    )
    .command(
        'begin <id> [name]',
        'Begin a new task',
        function (yargs) {
            return yargs
                .positional('id', {
                    describe: 'Task ID',
                    type: 'string',
                    required: true
                }).positional('name', {
                    describe: 'Task display name',
                    type: 'string',
                    default: ""
                })
        },
        async function (argv) {
            return handler.begin(argv['id'], argv['name']);
        }
    )
    .command(
        'update <id> <state>',
        'Update existing task',
        function (yargs) {
            return yargs
                .positional('id', {
                    describe: 'Task ID',
                    type: 'string',
                    required: true
                }).positional('state', {
                    describe: 'Task state',
                    type: 'string',
                    required: true
                })
        },
        async function (argv) {
            console.log(argv);
            return handler.update(argv['id'], argv['state']);
        }
    )
    .command(
        'end <id>',
        'End an existing task',
        function (yargs) {
            return yargs
                .positional('id', {
                    describe: 'Task ID',
                    type: 'string',
                    required: true
                });
        },
        async function (argv) {
            return handler.end(argv['id']);
        }
    )
    .command(
        'del <id>',
        'Delete an existing task',
        function (yargs) {
            return yargs
                .positional('id', {
                    describe: 'Task ID',
                    type: 'string',
                    required: true
                });
        },
        async function (argv) {
            return handler.del(argv['id']);
        }
    )
    .command(
        'list',
        'List tasks',
        function (yargs) {},
        async function (argv) {
            return handler.list();
        }
    )
    .demandCommand(1, 'No command was specifed')
    .version("1.0")
    .argv;